<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded from Scratch: i2c.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded from Scratch
   &#160;<span id="projectnumber">Project</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('i2c_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">i2c.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation of I2C peripheral configuration and independent calls to init, write, or read.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="i2c_8h_source.html">i2c.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="events_8h_source.html">events.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="gpio_8h_source.html">gpio.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="arm_8h_source.html">arm.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for i2c.c:</div>
<div class="dyncontent">
<div class="center"><img src="i2c_8c__incl.png" border="0" usemap="#ai2c_8c" alt=""/></div>
<map name="ai2c_8c" id="ai2c_8c">
<area shape="rect" title="Implementation of I2C peripheral configuration and independent calls to init, write,..." alt="" coords="63,5,115,32"/>
<area shape="rect" href="i2c_8h.html" title="Function prototypes, constants, and enums for I2C MMIO addresses, possible configuration values,..." alt="" coords="21,80,75,107"/>
<area shape="rect" href="arm_8h.html" title="Macro definitions, typedefs, and aliases for common ARM functionality." alt="" coords="14,155,74,181"/>
<area shape="rect" href="events_8h.html" title="Common event paradigm used by multiple peripherals including constant to indicate starting a task and..." alt="" coords="186,80,265,107"/>
<area shape="rect" href="gpio_8h.html" title="Function prototypes, constants, and enums for GPIO MMIO addresses, possible configuration values,..." alt="" coords="99,80,162,107"/>
<area shape="rect" href="error_8h.html" title="Constants for unified error codes across all peripherals. Each error code specifies exactly one uniqu..." alt="" coords="99,155,163,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3805872d127fa78471b6bc2f789825a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#a3805872d127fa78471b6bc2f789825a0">i2c_leader_init</a> ()</td></tr>
<tr class="separator:a3805872d127fa78471b6bc2f789825a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe4e90aa9276695138550c429fbd4922"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#afe4e90aa9276695138550c429fbd4922">i2c_leader_write</a> (<a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *tx_buf, <a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> tx_len, <a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> follower_addr)</td></tr>
<tr class="separator:afe4e90aa9276695138550c429fbd4922"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d39ca0a935245f8eca39b1b5dc466b9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#a1d39ca0a935245f8eca39b1b5dc466b9">i2c_leader_read</a> (<a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *rx_buf, <a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> rx_len, <a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> follower_addr)</td></tr>
<tr class="separator:a1d39ca0a935245f8eca39b1b5dc466b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae64172a328f99558be9799b3f3b0f714"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#ae64172a328f99558be9799b3f3b0f714">i2c_leader_stop</a> ()</td></tr>
<tr class="separator:ae64172a328f99558be9799b3f3b0f714"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of I2C peripheral configuration and independent calls to init, write, or read. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a3805872d127fa78471b6bc2f789825a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3805872d127fa78471b6bc2f789825a0">&#9670;&nbsp;</a></span>i2c_leader_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void i2c_leader_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initializes the TWIM0 peripheral with the provided SCL and SDA pins. Configures both pins with native Pullup resistors and standard 0 disconnected 1 according to specification. Leaves frequency at default 250 KHz to avoid driving the lux sensor quickly (under the 400 KHz that the sensor supports). All events monitored by by calls to i2c_leader_write, i2c_leader_write, and i2c_leader_stop are reset to avoid stale values. </p>

</div>
</div>
<a id="a1d39ca0a935245f8eca39b1b5dc466b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d39ca0a935245f8eca39b1b5dc466b9">&#9670;&nbsp;</a></span>i2c_leader_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int i2c_leader_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>rx_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>rx_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>follower_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Places <code>rx_buf</code> into the RXD.PTR register to identify destination for incoming bytes (with <code>rx_len</code> as length of <code>rx_buf</code> into RXD.MAXCNT register). Configures the initiated read to listen to address <code>follower_addr</code>. Triggers an I2C_STARTRX task and returns with a negative error code in the event of error or a 0 in the event of the LASTRX event being fired. The specification indicates that the STOP task should be triggered once the LASTRX event is received, so this function returns and is expected to either immediately call <code>i2c_leader_stop</code> or trigger a restart. </p>

</div>
</div>
<a id="ae64172a328f99558be9799b3f3b0f714"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae64172a328f99558be9799b3f3b0f714">&#9670;&nbsp;</a></span>i2c_leader_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void i2c_leader_stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Triggers a STOP task for the leader and blocks until the stop is successful. This function will always trigger a stop command when invoked and does not perform additional error checking on any bytes read/written since it was invoked. It may be necessary to check for one last error condition since both the read and write functions returned when the last byte was being written/read. </p>

</div>
</div>
<a id="afe4e90aa9276695138550c429fbd4922"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe4e90aa9276695138550c429fbd4922">&#9670;&nbsp;</a></span>i2c_leader_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int i2c_leader_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>tx_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>tx_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td>
          <td class="paramname"><em>follower_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Places <code>tx_buf</code> into the TXD.PTR register to identify source for data bytes being written and places <code>tx_len</code> as length of <code>tx_buf</code> into TXD.MAXCNT register. Configures the initiated write to target with address <code>follower_addr</code>. Triggers an I2C_STARTTX task and returns with a negative error code in the event of error or a 0 in the event of the LASTTX event being fired. The specification indicates that the STOP task should be triggered once the LASTTX event is received, so this function returns and is expected to either immediately call <code>i2c_leader_stop</code> or trigger a restart. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_3dd30a497388ee684638f120a124721c.html">src</a></li><li class="navelem"><a class="el" href="i2c_8c.html">i2c.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
