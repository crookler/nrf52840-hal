<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded from Scratch: timer.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded from Scratch
   &#160;<span id="projectnumber">Project</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('timer_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">timer.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Configures timer peripheral to match desired a desired frequency and perform a custom action within the TIMER0 interrupt handler.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="timer_8h_source.html">timer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stepper_8h_source.html">stepper.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ultrasonic_8h_source.html">ultrasonic.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for timer.c:</div>
<div class="dyncontent">
<div class="center"><img src="timer_8c__incl.png" border="0" usemap="#atimer_8c" alt=""/></div>
<map name="atimer_8c" id="atimer_8c">
<area shape="rect" title="Configures timer peripheral to match desired a desired frequency and perform a custom action within t..." alt="" coords="140,5,207,32"/>
<area shape="rect" href="timer_8h.html" title="Contains constants and structs used to configure the TIMER0 peripheral." alt="" coords="279,80,347,107"/>
<area shape="rect" href="stepper_8h.html" title="Useful structs and prototypes mirroring the stepper library maintained by Arduino (see here: https://..." alt="" coords="104,155,187,181"/>
<area shape="rect" href="ultrasonic_8h.html" title="Function stubs and structs for reading ultrasonic sensor ranges (following this datasheet https://www..." alt="" coords="37,80,136,107"/>
<area shape="rect" href="arm_8h.html" title="Macro definitions, typedefs, and aliases for common ARM functionality." alt="" coords="177,304,237,331"/>
<area shape="rect" href="events_8h.html" title="Common event paradigm used by multiple peripherals including constant to indicate starting a task and..." alt="" coords="313,155,391,181"/>
<area shape="rect" href="nvic_8h.html" title="Holds MMIO addresses for NVIC registers (and likely a NVIC struct eventually) that multiple periphera..." alt="" coords="416,155,477,181"/>
<area shape="rect" href="gpio_8h.html" title="Function prototypes, constants, and enums for GPIO MMIO addresses, possible configuration values,..." alt="" coords="73,229,135,256"/>
<area shape="rect" href="error_8h.html" title="Constants for unified error codes across all peripherals. Each error code specifies exactly one uniqu..." alt="" coords="72,304,136,331"/>
<area shape="rect" href="gpiote_8h.html" title="Enums and memory mapped addresses for configuring GPIOTE peripheral." alt="" coords="5,155,80,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac1e494b9eff92a9b78c20e22bbf3d6d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#ac1e494b9eff92a9b78c20e22bbf3d6d7">timer0_init</a> (int freq)</td></tr>
<tr class="separator:ac1e494b9eff92a9b78c20e22bbf3d6d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7ec887e79d91372664e4bb3fbf69162"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#ad7ec887e79d91372664e4bb3fbf69162">timer0_start</a> ()</td></tr>
<tr class="separator:ad7ec887e79d91372664e4bb3fbf69162"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7431d3fbc014f4481d7557e9e72de42a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a7431d3fbc014f4481d7557e9e72de42a">timer0_stop</a> ()</td></tr>
<tr class="separator:a7431d3fbc014f4481d7557e9e72de42a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35cf9de1ba6d20cc04226b163b1f73fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a35cf9de1ba6d20cc04226b163b1f73fc">TIMER0_Handler</a> ()</td></tr>
<tr class="separator:a35cf9de1ba6d20cc04226b163b1f73fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb302081b7dbd40d0fea4bbe53fd9b7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#abb302081b7dbd40d0fea4bbe53fd9b7b">timer1_init</a> ()</td></tr>
<tr class="separator:abb302081b7dbd40d0fea4bbe53fd9b7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93bf7d228be40a43afa04399e43bc8c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a93bf7d228be40a43afa04399e43bc8c7">timer1_start</a> ()</td></tr>
<tr class="separator:a93bf7d228be40a43afa04399e43bc8c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8148e6dd819794fd8a7d22f49796c11f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a8148e6dd819794fd8a7d22f49796c11f">timer1_stop</a> ()</td></tr>
<tr class="separator:a8148e6dd819794fd8a7d22f49796c11f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f452f8c3c922d2bd3f7da0f9e4844ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a3f452f8c3c922d2bd3f7da0f9e4844ab">TIMER1_Handler</a> ()</td></tr>
<tr class="separator:a3f452f8c3c922d2bd3f7da0f9e4844ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a63a47319af084d58af59d008a83f434e"><td class="memItemLeft" align="right" valign="top">volatile <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a63a47319af084d58af59d008a83f434e">timer0_num_interrupts_after_start</a> = 0</td></tr>
<tr class="memdesc:a63a47319af084d58af59d008a83f434e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Specifies the number of interrupts that should be handled by the TIMER0 handler after a start task is issued.  <a href="timer_8c.html#a63a47319af084d58af59d008a83f434e">More...</a><br /></td></tr>
<tr class="separator:a63a47319af084d58af59d008a83f434e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16036239635aa35de4df7e8c84001727"><td class="memItemLeft" align="right" valign="top">volatile <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="timer_8c.html#a16036239635aa35de4df7e8c84001727">timer0_num_interrupts_already_handled</a> = 0</td></tr>
<tr class="memdesc:a16036239635aa35de4df7e8c84001727"><td class="mdescLeft">&#160;</td><td class="mdescRight">Specifies the number of interrupts that have already been handled since the last start task was issued.  <a href="timer_8c.html#a16036239635aa35de4df7e8c84001727">More...</a><br /></td></tr>
<tr class="separator:a16036239635aa35de4df7e8c84001727"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Configures timer peripheral to match desired a desired frequency and perform a custom action within the TIMER0 interrupt handler. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a35cf9de1ba6d20cc04226b163b1f73fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35cf9de1ba6d20cc04226b163b1f73fc">&#9670;&nbsp;</a></span>TIMER0_Handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TIMER0_Handler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Custom handler for the TIMER0 peripheral that moves the stepper motor at the desired frequency. At each interrupt, the next control sequence of the stepper motor will be called. The timer itself is deactivated after the number of steps specified by the call to stepper_move is satisfied. Expected to manually clear the timer so that the timer will not count until wrap-around (i.e. once the single comparison value for the sampling frequency is reached then the timer is reset). Assumes that the only interrupts being generated from TIMER0 originate from the CC0 register being found as equal to the timer. </p>

</div>
</div>
<a id="ac1e494b9eff92a9b78c20e22bbf3d6d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1e494b9eff92a9b78c20e22bbf3d6d7">&#9670;&nbsp;</a></span>timer0_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timer0_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>freq</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configures the TIMER0 peripheral to begin firing interrupts at a rate <code>freq</code>. The comparison value for a 1 MHz timer (16 MHz default after subdividing) is calculated and loaded into CC0. Interrupts for the COMPARE[0] event are enabled, and the NVIC is configured to listen for interrupts originating from TIMER0. Finally, the counter is started (begins counting down) at the end of the function call. </p>

</div>
</div>
<a id="ad7ec887e79d91372664e4bb3fbf69162"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7ec887e79d91372664e4bb3fbf69162">&#9670;&nbsp;</a></span>timer0_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timer0_start </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Triggers timer to begin handling its own interrupts at the specified frequency (i.e. start to increment the counter value in timer mode). This can be used in default mode (without calling init) but behavior is undefined. </p>

</div>
</div>
<a id="a7431d3fbc014f4481d7557e9e72de42a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7431d3fbc014f4481d7557e9e72de42a">&#9670;&nbsp;</a></span>timer0_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timer0_stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Trigger timer to stop incrementing its own internal counter (but keeps the same configurations specified in timer_init). This can be used in default mode (without calling init) but behavior is undefined. </p>

</div>
</div>
<a id="a3f452f8c3c922d2bd3f7da0f9e4844ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f452f8c3c922d2bd3f7da0f9e4844ab">&#9670;&nbsp;</a></span>TIMER1_Handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TIMER1_Handler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Custom handler for the TIMER1 peripheral that simply sets the ultrasonic measurement to the maximum possible value If the timeout value is reached, the timer is stopped. Assumes that the timeout value is always in CC0 (so this should not be overwritten when capturing a valid timer value). </p>

</div>
</div>
<a id="abb302081b7dbd40d0fea4bbe53fd9b7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb302081b7dbd40d0fea4bbe53fd9b7b">&#9670;&nbsp;</a></span>timer1_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timer1_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configures the TIMER1 peripheral to be prepared to start counting at 1 MHz. Only generates an interrupt if the maximum value is reached (stored in CC[0]). If GPIOTE has falling edge before maximum value, this value is placed in CC[1] </p>

</div>
</div>
<a id="a93bf7d228be40a43afa04399e43bc8c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93bf7d228be40a43afa04399e43bc8c7">&#9670;&nbsp;</a></span>timer1_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timer1_start </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Triggers timer1 to begin counting upwards until max value is hit or GPIOTE handler is invoked. </p>

</div>
</div>
<a id="a8148e6dd819794fd8a7d22f49796c11f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8148e6dd819794fd8a7d22f49796c11f">&#9670;&nbsp;</a></span>timer1_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void timer1_stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Trigger timer1 to stop incrementing its own internal counter (but keeps the same configurations specified in timer_init). </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a63a47319af084d58af59d008a83f434e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63a47319af084d58af59d008a83f434e">&#9670;&nbsp;</a></span>timer0_num_interrupts_after_start</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> timer0_num_interrupts_after_start = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Specifies the number of interrupts that should be handled by the TIMER0 handler after a start task is issued. </p>

</div>
</div>
<a id="a16036239635aa35de4df7e8c84001727"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16036239635aa35de4df7e8c84001727">&#9670;&nbsp;</a></span>timer0_num_interrupts_already_handled</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> timer0_num_interrupts_already_handled = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Specifies the number of interrupts that have already been handled since the last start task was issued. </p>
<p>Specifies the number of interrupts that have already been handled since the last start task was issued for TIMER0. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_3dd30a497388ee684638f120a124721c.html">src</a></li><li class="navelem"><a class="el" href="timer_8c.html">timer.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
