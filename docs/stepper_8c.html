<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded from Scratch: stepper.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded from Scratch
   &#160;<span id="projectnumber">Project</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('stepper_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">stepper.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation of 4-wire stepper motor control using timer peripheral for custom speed and bidirectional support.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="stepper_8h_source.html">stepper.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timer_8h_source.html">timer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="error_8h_source.html">error.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for stepper.c:</div>
<div class="dyncontent">
<div class="center"><img src="stepper_8c__incl.png" border="0" usemap="#astepper_8c" alt=""/></div>
<map name="astepper_8c" id="astepper_8c">
<area shape="rect" title="Implementation of 4&#45;wire stepper motor control using timer peripheral for custom speed and bidirectio..." alt="" coords="85,5,166,32"/>
<area shape="rect" href="stepper_8h.html" title="Useful structs and prototypes mirroring the stepper library maintained by Arduino (see here: https://..." alt="" coords="5,80,88,107"/>
<area shape="rect" href="error_8h.html" title="Constants for unified error codes across all peripherals. Each error code specifies exactly one uniqu..." alt="" coords="93,229,157,256"/>
<area shape="rect" href="timer_8h.html" title="Contains constants and structs used to configure the TIMER0 peripheral." alt="" coords="191,80,259,107"/>
<area shape="rect" href="arm_8h.html" title="Macro definitions, typedefs, and aliases for common ARM functionality." alt="" coords="9,229,69,256"/>
<area shape="rect" href="gpio_8h.html" title="Function prototypes, constants, and enums for GPIO MMIO addresses, possible configuration values,..." alt="" coords="25,155,87,181"/>
<area shape="rect" href="events_8h.html" title="Common event paradigm used by multiple peripherals including constant to indicate starting a task and..." alt="" coords="214,155,293,181"/>
<area shape="rect" href="nvic_8h.html" title="Holds MMIO addresses for NVIC registers (and likely a NVIC struct eventually) that multiple periphera..." alt="" coords="317,155,379,181"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88c131f99dc75e8acc35b04a9ab3166e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stepper_8c.html#a88c131f99dc75e8acc35b04a9ab3166e">stepper_init</a> (<a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> steps_per_revolution, <a class="el" href="gpio_8h.html#a6d50d8c4b17ff573c07340d4d7965bc1">gpio_port</a> control_port_1, <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> control_pin_1, <a class="el" href="gpio_8h.html#a6d50d8c4b17ff573c07340d4d7965bc1">gpio_port</a> control_port_2, <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> control_pin_2, <a class="el" href="gpio_8h.html#a6d50d8c4b17ff573c07340d4d7965bc1">gpio_port</a> control_port_3, <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> control_pin_3, <a class="el" href="gpio_8h.html#a6d50d8c4b17ff573c07340d4d7965bc1">gpio_port</a> control_port_4, <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> control_pin_4)</td></tr>
<tr class="separator:a88c131f99dc75e8acc35b04a9ab3166e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00fcc924754fde4e43eed70a392f8ab3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stepper_8c.html#a00fcc924754fde4e43eed70a392f8ab3">stepper_speed</a> (<a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> rpm)</td></tr>
<tr class="separator:a00fcc924754fde4e43eed70a392f8ab3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c6788501db6840499474bc50f3b6fb9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stepper_8c.html#a0c6788501db6840499474bc50f3b6fb9">stepper_move</a> (<a class="el" href="arm_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> steps_to_move)</td></tr>
<tr class="separator:a0c6788501db6840499474bc50f3b6fb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8cab4eb8b8482fa8d45c720fa64d9e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stepper_8c.html#ac8cab4eb8b8482fa8d45c720fa64d9e6">stepper_advance_step</a> ()</td></tr>
<tr class="separator:ac8cab4eb8b8482fa8d45c720fa64d9e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a698d065d2a5992c1e76c2f75fdfc12b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structstepper__t.html">stepper_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stepper_8c.html#a698d065d2a5992c1e76c2f75fdfc12b3">attached_stepper</a></td></tr>
<tr class="memdesc:a698d065d2a5992c1e76c2f75fdfc12b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stepper motor currently attached to the nrf52840.  <a href="stepper_8c.html#a698d065d2a5992c1e76c2f75fdfc12b3">More...</a><br /></td></tr>
<tr class="separator:a698d065d2a5992c1e76c2f75fdfc12b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0e112b7812868321d64ff1cca027867"><td class="memItemLeft" align="right" valign="top"><a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="stepper_8c.html#ae0e112b7812868321d64ff1cca027867">stepper_init_called</a> = 0</td></tr>
<tr class="memdesc:ae0e112b7812868321d64ff1cca027867"><td class="mdescLeft">&#160;</td><td class="mdescRight">Boolean flag indicated if the stepper motor has been initialized (motor must be initialized before any other actions can be done)  <a href="stepper_8c.html#ae0e112b7812868321d64ff1cca027867">More...</a><br /></td></tr>
<tr class="separator:ae0e112b7812868321d64ff1cca027867"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of 4-wire stepper motor control using timer peripheral for custom speed and bidirectional support. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ac8cab4eb8b8482fa8d45c720fa64d9e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8cab4eb8b8482fa8d45c720fa64d9e6">&#9670;&nbsp;</a></span>stepper_advance_step()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stepper_advance_step </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Advance the stepper motor to the next step in the sequence. Direction is determined by <code>direction</code> field in <code>attached_stepper</code>. Apply the control sequence of the current step and then figure out the next step based on the direction of motion. </p>

</div>
</div>
<a id="a88c131f99dc75e8acc35b04a9ab3166e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88c131f99dc75e8acc35b04a9ab3166e">&#9670;&nbsp;</a></span>stepper_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stepper_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>steps_per_revolution</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="gpio_8h.html#a6d50d8c4b17ff573c07340d4d7965bc1">gpio_port</a>&#160;</td>
          <td class="paramname"><em>control_port_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>control_pin_1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="gpio_8h.html#a6d50d8c4b17ff573c07340d4d7965bc1">gpio_port</a>&#160;</td>
          <td class="paramname"><em>control_port_2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>control_pin_2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="gpio_8h.html#a6d50d8c4b17ff573c07340d4d7965bc1">gpio_port</a>&#160;</td>
          <td class="paramname"><em>control_port_3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>control_pin_3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="gpio_8h.html#a6d50d8c4b17ff573c07340d4d7965bc1">gpio_port</a>&#160;</td>
          <td class="paramname"><em>control_port_4</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>control_pin_4</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize a stepper motor configuration in the global <code>attached_stepper</code>. Start the 4-step control sequence at step zero and forward direction. Initialize associated gpio pins for control wires (IN1-IN4). </p>

</div>
</div>
<a id="a0c6788501db6840499474bc50f3b6fb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c6788501db6840499474bc50f3b6fb9">&#9670;&nbsp;</a></span>stepper_move()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stepper_move </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="arm_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a>&#160;</td>
          <td class="paramname"><em>steps_to_move</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Move the stepper motor through a number of steps according to <code>step_to_move</code>. Initializes a timer peripheral to begin firing interrupts at a rate equal to the <code>step_delay_us</code> of the attached stepper. Interrupts are fired repeatedly until steps_to_move have been counted, after which the timer peripheral is de-activated. This call is blocking so that user threads can accurately profile the time needed to turn the motor (i.e. do not have to dynamically change the task period based on how often the motor needs to be turned - can eliminate yielding by just treating the interrupt handler as work) Both CW and CCW directions are supported (sign of steps_to_move indicates direction with positive indicating CW and negative indicating CCW). </p>

</div>
</div>
<a id="a00fcc924754fde4e43eed70a392f8ab3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00fcc924754fde4e43eed70a392f8ab3">&#9670;&nbsp;</a></span>stepper_speed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stepper_speed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>rpm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set the stepper motor speed to the requested revolutions per minute. Stepping delay is managed by TIMER0, so determine the necessary frequency of interrupts for TIMER0 to have. TIMER0 handler. is responsible for actually calling the advance motor functions during its interrupt. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a698d065d2a5992c1e76c2f75fdfc12b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a698d065d2a5992c1e76c2f75fdfc12b3">&#9670;&nbsp;</a></span>attached_stepper</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structstepper__t.html">stepper_t</a> attached_stepper</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stepper motor currently attached to the nrf52840. </p>
<p>Stepper motor currently attached to the nrf52840 (assuming only one used at a time) </p>

</div>
</div>
<a id="ae0e112b7812868321d64ff1cca027867"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0e112b7812868321d64ff1cca027867">&#9670;&nbsp;</a></span>stepper_init_called</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> stepper_init_called = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Boolean flag indicated if the stepper motor has been initialized (motor must be initialized before any other actions can be done) </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_3dd30a497388ee684638f120a124721c.html">src</a></li><li class="navelem"><a class="el" href="stepper_8c.html">stepper.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
