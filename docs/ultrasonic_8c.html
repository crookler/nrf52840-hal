<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded from Scratch: ultrasonic.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded from Scratch
   &#160;<span id="projectnumber">Project</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ultrasonic_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">ultrasonic.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides functionality for creating the protocol for the HC-SR04 ultrasonic range sensor.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="ultrasonic_8h_source.html">ultrasonic.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="nvic_8h_source.html">nvic.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="events_8h_source.html">events.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timer_8h_source.html">timer.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ultrasonic.c:</div>
<div class="dyncontent">
<div class="center"><img src="ultrasonic_8c__incl.png" border="0" usemap="#aultrasonic_8c" alt=""/></div>
<map name="aultrasonic_8c" id="aultrasonic_8c">
<area shape="rect" title="Provides functionality for creating the protocol for the HC&#45;SR04 ultrasonic range sensor." alt="" coords="173,5,270,32"/>
<area shape="rect" href="ultrasonic_8h.html" title="Function stubs and structs for reading ultrasonic sensor ranges (following this datasheet https://www..." alt="" coords="49,80,148,107"/>
<area shape="rect" href="nvic_8h.html" title="Holds MMIO addresses for NVIC registers (and likely a NVIC struct eventually) that multiple periphera..." alt="" coords="155,155,216,181"/>
<area shape="rect" href="events_8h.html" title="Common event paradigm used by multiple peripherals including constant to indicate starting a task and..." alt="" coords="291,155,370,181"/>
<area shape="rect" href="timer_8h.html" title="Contains constants and structs used to configure the TIMER0 peripheral." alt="" coords="223,80,291,107"/>
<area shape="rect" href="arm_8h.html" title="Macro definitions, typedefs, and aliases for common ARM functionality." alt="" coords="94,304,154,331"/>
<area shape="rect" href="gpiote_8h.html" title="Enums and memory mapped addresses for configuring GPIOTE peripheral." alt="" coords="5,155,80,181"/>
<area shape="rect" href="gpio_8h.html" title="Function prototypes, constants, and enums for GPIO MMIO addresses, possible configuration values,..." alt="" coords="11,229,74,256"/>
<area shape="rect" href="error_8h.html" title="Constants for unified error codes across all peripherals. Each error code specifies exactly one uniqu..." alt="" coords="5,304,69,331"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a61029a1fa3e7e8f62b83ae56498c58d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ultrasonic_8c.html#a61029a1fa3e7e8f62b83ae56498c58d3">ultrasonic_init</a> ()</td></tr>
<tr class="separator:a61029a1fa3e7e8f62b83ae56498c58d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99faf3cc0e8e57e0288d9751af07a3d9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ultrasonic_8c.html#a99faf3cc0e8e57e0288d9751af07a3d9">ultrasonic_range</a> ()</td></tr>
<tr class="separator:a99faf3cc0e8e57e0288d9751af07a3d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2b75f4c3658d977267c9647f8a00b6c4"><td class="memItemLeft" align="right" valign="top">volatile <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ultrasonic_8c.html#a2b75f4c3658d977267c9647f8a00b6c4">last_ultrasonic_measurement</a> = 0</td></tr>
<tr class="memdesc:a2b75f4c3658d977267c9647f8a00b6c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">The value of the last measurement (range in cm) obtained from the ultrasonic sensor (max range is roughly 300 cm)  <a href="ultrasonic_8c.html#a2b75f4c3658d977267c9647f8a00b6c4">More...</a><br /></td></tr>
<tr class="separator:a2b75f4c3658d977267c9647f8a00b6c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c35d99c74fff095c1c4a8375fb2216d"><td class="memItemLeft" align="right" valign="top">volatile <a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ultrasonic_8c.html#a7c35d99c74fff095c1c4a8375fb2216d">in_measurement</a> = 0</td></tr>
<tr class="memdesc:a7c35d99c74fff095c1c4a8375fb2216d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag for saying if an event has already been serviced dealing with the start of the signal (rising edge - if so the next interrupt should take a different action)  <a href="ultrasonic_8c.html#a7c35d99c74fff095c1c4a8375fb2216d">More...</a><br /></td></tr>
<tr class="separator:a7c35d99c74fff095c1c4a8375fb2216d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides functionality for creating the protocol for the HC-SR04 ultrasonic range sensor. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a61029a1fa3e7e8f62b83ae56498c58d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61029a1fa3e7e8f62b83ae56498c58d3">&#9670;&nbsp;</a></span>ultrasonic_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ultrasonic_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configure the ultrasonic sensor by setting up GPIO pins. Initialize GPIOTE configuration to allow reading when a measurement is complete. </p>

</div>
</div>
<a id="a99faf3cc0e8e57e0288d9751af07a3d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99faf3cc0e8e57e0288d9751af07a3d9">&#9670;&nbsp;</a></span>ultrasonic_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> ultrasonic_range </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read the current range of the ultrasonic sensor. Trigger a measurement to begin by writing very briefly (10 uS) to the trigger pin. Reset last_ultrasonic_measurement global variable to a holding value and wait for GPIOTE interrupt to calculate and set the calculated range. Timer interrupt may set an infinite range if the timer has already gone past when the echo pulse was expected to return. Need to allow about 10 ms between calls to this function (use yield at user level if calling by threads). </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a7c35d99c74fff095c1c4a8375fb2216d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c35d99c74fff095c1c4a8375fb2216d">&#9670;&nbsp;</a></span>in_measurement</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="arm_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> in_measurement = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flag for saying if an event has already been serviced dealing with the start of the signal (rising edge - if so the next interrupt should take a different action) </p>

</div>
</div>
<a id="a2b75f4c3658d977267c9647f8a00b6c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b75f4c3658d977267c9647f8a00b6c4">&#9670;&nbsp;</a></span>last_ultrasonic_measurement</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="arm_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> last_ultrasonic_measurement = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The value of the last measurement (range in cm) obtained from the ultrasonic sensor (max range is roughly 300 cm) </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_3dd30a497388ee684638f120a124721c.html">src</a></li><li class="navelem"><a class="el" href="ultrasonic_8c.html">ultrasonic.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
